<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fast ED Note – Medical History (Options Only)</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1224; --card:#111b33; --muted:#94a3b8; --text:#e5e7eb;
      --brand:#22c55e; --border:#1f2a44; --chip:#1e293b; --chip-hover:#0f172a; --radius:14px;
      --shadow: 0 8px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background: radial-gradient(1200px 700px at 85% -10%, #0a6 0%, transparent 55%) fixed,
                  radial-gradient(900px 600px at -10% 110%, #09c 0%, transparent 50%) fixed,
                  var(--bg);}
    header{padding:20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:42px;height:42px;border-radius:12px;background:conic-gradient(from 210deg at 70% 30%, #22c55e,#06b6d4);
      box-shadow:inset 0 0 0 2px rgba(255,255,255,.08),var(--shadow)}
    h1{margin:0;font-size:1.15rem}
    .muted{color:var(--muted);font-size:.92rem}
    .wrap{display:grid;grid-template-columns:1.6fr 1fr;gap:18px;padding:0 20px 24px}
    @media (max-width:1100px){.wrap{grid-template-columns:1fr}}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 30%),var(--panel);
      border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
    .note-panel{position:sticky;top:16px;align-self:start}
    .section{margin:14px 0;padding:14px;border:1px dashed var(--border);border-radius:12px;background:rgba(255,255,255,.02)}
    .section h3{margin:0 0 10px;font-size:1.02rem}
    .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:720px){.grid-two{grid-template-columns:1fr}}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;background:var(--chip);
      border:1px solid var(--border);cursor:pointer;transition:.2s}
    .chip:hover{background:var(--chip-hover)}
    .chip input{accent-color:var(--brand);transform:scale(1.15)}
    input[type="number"],select{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);
      background:#0b1326;color:var(--text);outline:none}
    .kicker{color:#a7f3d0;font-weight:700}
    .stepper{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 12px}
    .step{padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:#0b1224;color:var(--muted);
      font-weight:600;font-size:.9rem}
    .step.active{color:#10b981;border-color:#10b981}
    .divider{height:1px;background:linear-gradient(90deg,transparent,#1f2a44,transparent);margin:14px 0}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{background:linear-gradient(180deg,rgba(255,255,255,.07),transparent),var(--card);color:var(--text);
      border:1px solid var(--border);padding:12px 14px;border-radius:12px;cursor:pointer;transition:.2s;font-weight:600}
    button.primary{background:linear-gradient(180deg,rgba(255,255,255,.12),transparent),#14532d;border-color:#1d4ed8}
    button:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.25)}
    .note{white-space:pre-wrap;background:linear-gradient(180deg,rgba(255,255,255,.03),transparent),var(--card);
      border:1px solid var(--border);border-radius:12px;padding:14px;min-height:320px;font-family:ui-monospace,Consolas,monospace}
    .hidden{display:none !important}
    .warn{color:#fca5a5}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.8rem;border:1px solid var(--border);
      background:#0e1a32;color:#93c5fd}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Fast ED Note – <span class="kicker">English terse style</span></h1>
        <div class="muted">Age first → all inputs by options → note auto‑builds in your exact format.</div>
      </div>
    </div>
    <div><span class="tag">HTML+CSS+JS</span></div>
  </header>

  <div class="wrap">
    <main class="panel">
      <div class="stepper" id="stepper"></div>

      <!-- STEP 1: AGE -->
      <section class="section" id="step-age">
        <h3>1) Enter age first</h3>
        <div class="grid-two">
          <div>
            <label for="age"><strong>Age (years)</strong></label>
            <input id="age" type="number" min="0" max="120" placeholder="e.g., 7" />
          </div>
          <div style="display:flex;align-items:end">
            <button id="confirmAge" class="primary">Confirm age</button>
          </div>
        </div>
        <div id="ageWarn" class="muted warn hidden">Please enter age 0–120.</div>
      </section>

      <!-- DYNAMIC SECTIONS -->
      <div id="dynamicSections" class="hidden"></div>

      <div class="divider"></div>
      <div class="actions hidden" id="finalActions">
        <button id="copyNote">Copy note</button>
        <button id="downloadTxt">Download TXT</button>
        <button id="printNote">Print</button>
        <div class="muted">Note updates live as you change options.</div>
      </div>
    </main>

    <aside class="panel note-panel">
      <h3>Auto‑Generated Note</h3>
      <div id="noteBox" class="note">Enter age to start…</div>
    </aside>
  </div>

  <script>
    // ---- State ----
    const state = { age:null, answers:{} };
    const $ = (s,el=document)=>el.querySelector(s);
    const $$ = (s,el=document)=>[...el.querySelectorAll(s)];
    const byId = id=>document.getElementById(id);

    // ---- Schema (English, terse ED style) ----
    const SCHEMA = [
      {
        id:"demographics",
        title:"2) Demographics & PMH",
        questions:[
          {
            key:"gender", label:"Sex", type:"radio",
            options:["male","female","unspecified"], default:"male"
          },
          {
            key:"pmh", label:"Past medical history", type:"radio",
            options:["Medical free","Known conditions"], default:"Medical free"
          },
          {
            key:"pmh_known", label:"If 'Known conditions'", type:"checkbox",
            options:["DM","HTN","Asthma","Cardiac","Renal","Thyroid","Dyslipidemia","Psych"], showIf:(a)=>a.pmh==="Known conditions"
          }
        ],
        summarize(a){
          const g = a.gender||"unspecified";
          if(a.pmh==="Known conditions"){
            const list = (a.pmh_known||[]).join(" ");
            return `${state.age ?? "?"} y/o ${g} ${list||"with PMH"}`;
          }
          return `${state.age ?? "?"} y/o ${g} Medical free`;
        }
      },
      {
        id:"visit",
        title:"3) Visit context & CC",
        questions:[
          {
            key:"location", label:"Came to", type:"radio",
            options:["AR","ER","OPD"], default:"AR"
          },
          {
            key:"cc", label:"Complaining of", type:"checkbox",
            options:["cough","fever","runny nose","sore throat","vomiting","diarrhea","abdominal pain","headache","dyspnea","palpitation","other"]
          },
          {
            key:"duration", label:"Duration", type:"radio",
            options:["for one day","for two days","for three days","for 1 week","for 2 weeks","for 1 month","since today"],
            default:"for three days"
          },
          {
            key:"assoc_none", label:"Associated symptoms", type:"radio",
            options:["No other associated symptoms","Has associated symptoms"], default:"No other associated symptoms"
          },
          {
            key:"assoc_list", label:"If 'Has associated symptoms'", type:"checkbox",
            options:["sore throat","vomiting","diarrhea","headache","rash","chills","myalgia","other"],
            showIf:(a)=>a.assoc_none==="Has associated symptoms"
          }
        ],
        summarize(a){
          const loc = a.location||"AR";
          const ccArr = (a.cc||[]).filter(x=>x!=="other");
          const ccOther = (a.cc||[]).includes("other") ? (a.cc_other||"other") : "";
          const ccText = [ccArr.join(" "), ccOther].filter(Boolean).join(" ");
          const dur = a.duration || "";
          let assoc = a.assoc_none || "No other associated symptoms";
          if(assoc==="Has associated symptoms"){
            const list = (a.assoc_list||[]).filter(x=>x!=="other");
            const oth = (a.assoc_list||[]).includes("other") ? (a.assoc_list_other||"other") : "";
            assoc = `Associated with ${[list.join(" "),oth].filter(Boolean).join(" ")}`;
          }
          return `Came to ${loc}, complaining of ${ccText||"—"}
${capitalizeFirst(dur)}
${assoc}`;
        }
      },
      {
        id:"exam",
        title:"4) Examination (preset phrases)",
        questions:[
          {
            key:"gen_look", label:"General appearance", type:"checkbox",
            options:["patient looks well","conscious","alert","not in distress","febrile","toxic"], defaultChecked:["patient looks well","conscious","alert","not in distress"]
          },
          {
            key:"chest", label:"Chest", type:"radio",
            options:["just equal bilateral air entry","wheezes","crackles","reduced air entry one side"],
            default:"just equal bilateral air entry"
          },
          {
            key:"abd", label:"Abdomen", type:"radio",
            options:["abdomen soft lax","tender RUQ","tender RLQ","generalized tenderness","guarding"], default:"abdomen soft lax"
          },
          {
            key:"others", label:"Other systems", type:"radio",
            options:["other examinations are unremarkable","neuro focal deficit","dehydrated","skin rash"], default:"other examinations are unremarkable"
          }
        ],
        summarize(a){
          const gen = (a.gen_Look_final || defaultGen()).join(" ");
          const chest = a.chest || "just equal bilateral air entry";
          const abd = a.abd || "abdomen soft lax";
          const oth = a.others || "other examinations are unremarkable";
          return `On examination, ${gen} ${chest} ${abd}, ${oth}`;
        }
      }
    ];

    // ---- Build UI ----
    const root = byId('dynamicSections');
    const stepper = byId('stepper');

    function buildStepper(){
      stepper.innerHTML = '';
      const steps = [
        {id:'step-age', label:'Age'},
        ...SCHEMA.map(s=>({id:s.id, label:s.title.replace(/^\d+\)\s*/,'')}))
      ];
      steps.forEach((st,i)=>{
        const b=document.createElement('div');
        b.className='step'+(i===0?' active':'');
        b.dataset.target=st.id;
        b.textContent=`${i+1}. ${st.label}`;
        stepper.appendChild(b);
      });
    }

    function buildSections(){
      root.innerHTML='';
      SCHEMA.forEach(section=>{
        const sec=document.createElement('section'); sec.className='section'; sec.id=section.id;
        const h=document.createElement('h3'); h.textContent=section.title; sec.appendChild(h);

        section.questions.forEach(q=>{
          const block=document.createElement('div'); block.className='row';

          // label
          const label=document.createElement('div');
          label.innerHTML=`<div class="muted" style="margin-bottom:8px">${q.label}</div>`;
          block.appendChild(label);

          const group=document.createElement('div'); group.className='row'; group.dataset.group=q.key;

          if(q.type==='radio' || q.type==='checkbox'){
            q.options.forEach(opt=>{
              const id=`${section.id}-${q.key}-${opt.replace(/\s+/g,'-')}`;
              const wrap=document.createElement('label'); wrap.className='chip';
              const input=document.createElement('input'); input.type=q.type; input.value=opt; input.id=id;
              if(q.type==='radio'){ input.name=q.key; }
              else { input.name=q.key+'[]'; }

              // defaults for checkbox general appearance
              if(q.defaultChecked && q.defaultChecked.includes(opt)){ input.checked=true; }

              input.addEventListener('change', ()=>{
                if(q.type==='radio'){ state.answers[q.key]=opt; }
                else{
                  const arr=[...group.querySelectorAll('input[type=checkbox]')].filter(c=>c.checked).map(c=>c.value);
                  state.answers[q.key]=arr;
                }
                handleShowIf();
                renderNote();
              });
              wrap.appendChild(input);
              const span=document.createElement('span'); span.textContent=opt; wrap.appendChild(span);
              group.appendChild(wrap);
            });

            // support "other" free text if option "other" exists
            if(q.options.includes("other") || q.options.includes("Other")){
              const otherWrap=document.createElement('div'); otherWrap.className='grid-two hidden'; otherWrap.id=`${section.id}-${q.key}-other-wrap`;
              otherWrap.innerHTML=`<div class="muted">Specify other:</div>
                                   <input type="text" id="${section.id}-${q.key}-other" placeholder="Type a short phrase…">`;
              block.appendChild(otherWrap);
              block.addEventListener('change', ()=>{
                const sel = (q.type==='radio') ? state.answers[q.key] : (state.answers[q.key]||[]);
                const hasOther = (q.type==='radio') ? sel==="other" : sel.includes("other");
                otherWrap.classList.toggle('hidden', !hasOther);
              });
              block.addEventListener('input', (e)=>{
                const f=byId(`${section.id}-${q.key}-other`);
                if(e.target===f){ state.answers[`${q.key}_other`]=f.value.trim(); renderNote(); }
              });
            }

          } else if(q.type==='select'){
            const sel=document.createElement('select'); sel.id=`${section.id}-${q.key}`;
            q.options.forEach(opt=>{ const o=document.createElement('option'); o.value=opt; o.textContent=opt; sel.appendChild(o); });
            sel.addEventListener('change', ()=>{ state.answers[q.key]=sel.value; handleShowIf(); renderNote(); });
            group.appendChild(sel);
          }

          block.appendChild(group);
          sec.appendChild(block);
        });

        root.appendChild(sec);
      });
      handleShowIf(true);
    }

    function handleShowIf(initial=false){
      SCHEMA.forEach(section=>{
        section.questions.forEach(q=>{
          if(q.showIf){
            const show=!!q.showIf(state.answers);
            const block=[...byId(section.id).querySelectorAll('[data-group]')].find(g=>g.dataset.group===q.key)?.closest('.row');
            if(block){ block.classList.toggle('hidden', !show); }
          }
        });
      });

      // keep array for general appearance
      state.answers.gen_Look_final = (state.answers.gen_look || defaultGen());
      if(initial) renderNote();
    }

    function defaultGen(){ return ["patient looks well","conscious","alert","not in distress"]; }

    // ---- Note rendering (exact style) ----
    function renderNote(){
      const lines = [];

      // Demographics line (from summarize)
      lines.push(findSection("demographics"));

      // Visit + CC + Duration + Associated
      const visitSummary = findSection("visit");
      lines.push(visitSummary);

      // Examination
      lines.push(findSection("exam"));

      byId('noteBox').textContent = lines.filter(Boolean).join('\n');
      // Stepper active
      $$('.step', stepper).forEach(st=>{
        const target=st.dataset.target;
        const active = target==='step-age' ? !!state.age : !!byId(target);
        st.classList.toggle('active', active);
      });
    }

    function findSection(id){
      const sec = SCHEMA.find(s=>s.id===id);
      return sec ? sec.summarize(state.answers) : '';
    }

    // ---- Age gate ----
    byId('confirmAge').addEventListener('click', ()=>{
      const val = Number(byId('age').value);
      const ok = Number.isFinite(val) && val>=0 && val<=120;
      byId('ageWarn').classList.toggle('hidden', ok);
      if(!ok) return;
      state.age = val;
      byId('dynamicSections').classList.remove('hidden');
      byId('finalActions').classList.remove('hidden');
      if(!byId(SCHEMA[0].id)){ buildSections(); }
      renderNote();
      byId(SCHEMA[0].id).scrollIntoView({behavior:'smooth',block:'start'});
    });

    // Keyboard: Enter on age
    byId('age').addEventListener('keydown',(e)=>{ if(e.key==='Enter') byId('confirmAge').click(); });

    // ---- Actions ----
    byId('copyNote').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(byId('noteBox').textContent); flash('Copied ✅'); }
      catch{ flash('Clipboard blocked – select & copy manually.', true); }
    });
    byId('downloadTxt').addEventListener('click', ()=>{
      const blob = new Blob([byId('noteBox').textContent], {type:'text/plain;charset=utf-8'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ed-note.txt'; a.click();
      URL.revokeObjectURL(a.href);
    });
    byId('printNote').addEventListener('click', ()=>window.print());

    function flash(msg,isErr=false){
      const b=document.createElement('div');
      Object.assign(b.style,{position:'fixed',right:'20px',bottom:'20px',padding:'10px 12px',border:'1px solid var(--border)',
        borderRadius:'12px',background:isErr?'#7f1d1d':'#064e3b',color:'#fff',boxShadow:'0 10px 30px rgba(0,0,0,.35)'});
      b.textContent=msg; document.body.appendChild(b); setTimeout(()=>b.remove(),2000);
    }

    // init
    buildStepper();
    renderNote();

    function capitalizeFirst(s){ return s ? s.charAt(0).toUpperCase()+s.slice(1) : s; }
  </script>
</body>
</html>